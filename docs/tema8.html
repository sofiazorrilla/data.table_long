<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Reformatear tablas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
        <div class="quarto-navbar-tools ms-auto">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://github.com/sofiazorrilla/data.table_long/blob/main/README.md">
            Source Code
            </a>
          </li>
      </ul>
    </div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tema3.html">Operaciones</a></li><li class="breadcrumb-item"><a href="./tema8.html">Reformatear tablas</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introducción</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción y recursos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sintaxis básica</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Importar y exportar datos</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Operaciones</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Filtros y selección de columnas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modificación de columnas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agrupación y cadenas de operaciones</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Uniones entre tablas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema8.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Reformatear tablas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">.SD()</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tema6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ejercicios</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#larga-a-ancha" id="toc-larga-a-ancha" class="nav-link active" data-scroll-target="#larga-a-ancha">Larga a ancha</a></li>
  <li><a href="#ancha-a-larga" id="toc-ancha-a-larga" class="nav-link" data-scroll-target="#ancha-a-larga">Ancha a larga</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Reformatear tablas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Las funciones para cambiar las tablas de formato son <code>melt</code> y <code>dcast</code>. Estas funciones están optimizadas para funcionar con grandes cantidades de datos guardados en memoria (10GB).</p>
<section id="larga-a-ancha" class="level2">
<h2 class="anchored" data-anchor-id="larga-a-ancha">Larga a ancha</h2>
<p>Actualmente tenemos una tabla larga. Vamos a convertirla en una tabla en la que las columnas sean los 73 paises y las canciones las filas. Los valores van a ser el numero de veces en las que cada canción ha aparecido en el listado de las 50 canciones más populares (<code>data</code>) en el último año. Adicionalmente vamos a mantener la columna de la fecha del listado (snapshot_date) pero la vamos a modificar de modo que nos quedemos con el mes y el año.</p>
<p>Larga a ancha:</p>
<pre><code>dcast(data, formula, fun.aggregate = NULL, sep = "_",
    ..., margins = NULL, subset = NULL, fill = NULL,
    drop = TRUE, value.var = guess(data),
    verbose = getOption("datatable.verbose"))</code></pre>
<p><img src="img/dcast.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a utilizar la tabla de canciones del top50 en 73 paises</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Queremos crear una tabla de conteos de cada cancion por pais por mes en el que se hizo el listado top 50</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>freq_song_long <span class="ot">&lt;-</span> data[country <span class="sc">!=</span> <span class="st">""</span>,.(.N), by <span class="ot">=</span> .(name,country,<span class="at">month_yr =</span> <span class="fu">format</span>(snapshot_date,<span class="st">"%Y-%m"</span>))]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>freq_song_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                     name country month_yr     N
                                                   &lt;char&gt;  &lt;char&gt;   &lt;char&gt; &lt;int&gt;
    1:  Yebo Lapho (Gogo) (feat. DJ Maphorisa &amp; Djy Biza)      ZA  2024-09     8
    2: Sdakiwe Sbali (feat. Bless The Gentleman &amp; DJ Kap)      ZA  2024-09     8
    3:      Mfazi Wephepha (feat. Big Zulu &amp; Zee Nxumalo)      ZA  2024-09     8
    4:      Kwelanga 2.0 (feat. Tman Xpress &amp; LeeMcKrazy)      ZA  2024-09     8
    5:                     eGoli (feat. Eltee &amp; Novatron)      ZA  2024-09     8
   ---                                                                          
75846:                  Nachts wach (Lila Wolken Bootleg)      AT  2023-10     2
75847:                                             HIBIKI      AR  2023-10     2
75848:                          Slime You Out (feat. SZA)      AE  2023-10     2
75849:                  SAY MY GRACE (feat. Travis Scott)      AE  2023-10     2
75850:                                         Rainy Days      AE  2023-10     2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>freq_song_wide <span class="ot">&lt;-</span> <span class="fu">dcast</span>(freq_song_long, month_yr<span class="sc">+</span>name<span class="sc">~</span>country, <span class="at">value.var =</span> <span class="st">"N"</span>, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>freq_song_wide[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;month_yr, name&gt;
       month_yr                                          name    AE    AR    AT    AU    BE    BG    BO
         &lt;char&gt;                                        &lt;char&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
    1:  2023-10                                                   0     0     0     0     0     0     0
    2:  2023-10 ""Slut!"" (Taylor's Version) (From The Vault)     3     0     3     3     3     3     0
    3:  2023-10                                   $AD BOYZ II     0     0     0     0     0     0     0
    4:  2023-10                  (It Goes Like) Nanana - Edit     0     0     0     5    14     0     0
    5:  2023-10                                   0800 HEAVEN     0     0     0     0     0     0     0
   ---                                                                                                 
37446:  2024-09                                        青と夏     0     0     0     0     0     0     0
37447:  2024-09                                高嶺の花子さん     0     0     0     0     0     0     0
37448:  2024-09                                          黑月     0     0     0     0     0     0     0
37449:  2024-09                                        黑玻璃     0     0     0     0     0     0     0
37450:  2024-09                            별별별 (See that?)     0     0     0     0     0     0     0</code></pre>
</div>
</div>
<p>La función dcast también nos permite agregar valores de acuerdo a una función mientras cambiamos el formato de las tablas. Esto es útil cuando nuestra fórmula no puede identificar de manera única cada fila. Por ejemplo, si quiseramos comparar la popularidad promedio de cada canción entre el 2023 y el 2024 podemos hacer lo siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(data[country <span class="sc">!=</span> <span class="st">""</span>], country <span class="sc">+</span> name <span class="sc">~</span> <span class="fu">format</span>(snapshot_date,<span class="st">"%Y"</span>), <span class="at">value.var =</span> <span class="st">"popularity"</span>, <span class="at">fun.aggregate =</span> <span class="cf">function</span>(x){<span class="fu">round</span>(<span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),<span class="at">digits =</span> <span class="dv">1</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country, name&gt;
       country                                                                 name  2023  2024
        &lt;char&gt;                                                               &lt;char&gt; &lt;num&gt; &lt;num&gt;
    1:      AE                        ""Slut!"" (Taylor's Version) (From The Vault)  85.4   NaN
    2:      AE                                         (It Goes Like) Nanana - Edit   NaN  87.0
    3:      AE                                                            100 Bands   NaN  53.4
    4:      AE                                                                   22   NaN  35.0
    5:      AE                                                               3 Days   NaN   1.0
   ---                                                                                         
29523:      ZA uKhome Lotto (feat. Agzo, Optimist Music ZA, Seun1401 &amp; El.Stephano)   NaN  55.3
29524:      ZA                        uLala Kanjani (feat. LeeMcKrazy &amp; Skandisoul)  61.0   NaN
29525:      ZA                             we can't be friends (wait for your love)   NaN  91.5
29526:      ZA                                                    whatsapp (wassam)   NaN   0.0
29527:      ZA                                                            yes, and?   NaN  84.0</code></pre>
</div>
</div>
<p>Ahora imagina que te gustaría pasar de ancha a larga utilizando dos columnas. Por ejemplo, para compara la popularidad y el ranking promedio por año. Podemos indicar múltiples columnas en <code>value.var</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pop_rank_per_year <span class="ot">&lt;-</span> <span class="fu">dcast</span>(data[country <span class="sc">!=</span> <span class="st">""</span>], country <span class="sc">+</span> name <span class="sc">~</span> <span class="fu">format</span>(snapshot_date,<span class="st">"%Y"</span>), <span class="at">value.var =</span> <span class="fu">c</span>(<span class="st">"daily_rank"</span>, <span class="st">"popularity"</span>), <span class="at">sep =</span> <span class="st">"."</span>, <span class="at">fun.aggregate =</span> <span class="cf">function</span>(x){<span class="fu">round</span>(<span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),<span class="at">digits =</span> <span class="dv">1</span>)})</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pop_rank_per_year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;country, name&gt;
       country                                                                 name daily_rank.2023 daily_rank.2024
        &lt;char&gt;                                                               &lt;char&gt;           &lt;num&gt;           &lt;num&gt;
    1:      AE                        ""Slut!"" (Taylor's Version) (From The Vault)            28.7             NaN
    2:      AE                                         (It Goes Like) Nanana - Edit             NaN            33.0
    3:      AE                                                            100 Bands             NaN             2.7
    4:      AE                                                                   22             NaN            26.0
    5:      AE                                                               3 Days             NaN             1.0
   ---                                                                                                             
29523:      ZA uKhome Lotto (feat. Agzo, Optimist Music ZA, Seun1401 &amp; El.Stephano)             NaN            42.0
29524:      ZA                        uLala Kanjani (feat. LeeMcKrazy &amp; Skandisoul)            33.1             NaN
29525:      ZA                             we can't be friends (wait for your love)             NaN            33.3
29526:      ZA                                                    whatsapp (wassam)             NaN            42.0
29527:      ZA                                                            yes, and?             NaN            30.5
       popularity.2023 popularity.2024
                 &lt;num&gt;           &lt;num&gt;
    1:            85.4             NaN
    2:             NaN            87.0
    3:             NaN            53.4
    4:             NaN            35.0
    5:             NaN             1.0
   ---                                
29523:             NaN            55.3
29524:            61.0             NaN
29525:             NaN            91.5
29526:             NaN             0.0
29527:             NaN            84.0</code></pre>
</div>
</div>
</section>
<section id="ancha-a-larga" class="level2">
<h2 class="anchored" data-anchor-id="ancha-a-larga">Ancha a larga</h2>
<p>Ancha a larga:</p>
<pre><code>melt(data, id.vars, measure.vars,
    variable.name = "variable", value.name = "value",
    ..., na.rm = FALSE, variable.factor = TRUE,
    value.factor = FALSE,
    verbose = getOption("datatable.verbose"))</code></pre>
<p><img src="img/merge.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>freq_song_long2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(freq_song_wide, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"month_yr"</span>,<span class="st">"name"</span>), <span class="at">variable.name =</span> <span class="st">"country"</span>, <span class="at">value.name =</span> <span class="st">"N"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>freq_song_long2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         month_yr                                          name country     N
           &lt;char&gt;                                        &lt;char&gt;  &lt;fctr&gt; &lt;int&gt;
      1:  2023-10                                                    AE     0
      2:  2023-10 ""Slut!"" (Taylor's Version) (From The Vault)      AE     3
      3:  2023-10                                   $AD BOYZ II      AE     0
      4:  2023-10                  (It Goes Like) Nanana - Edit      AE     0
      5:  2023-10                                   0800 HEAVEN      AE     0
     ---                                                                     
2696396:  2024-09                                        青と夏      ZA     0
2696397:  2024-09                                高嶺の花子さん      ZA     0
2696398:  2024-09                                          黑月      ZA     0
2696399:  2024-09                                        黑玻璃      ZA     0
2696400:  2024-09                            별별별 (See that?)      ZA     0</code></pre>
</div>
</div>
<p>De manera similar a <code>dcast</code>, podemos reformatear una tabla para conservar más de una columna en la tabla en formato largo. Por ejemplo, si tenemos la tabla generada anteriormente con el ranking promedio diario por año y la popularidad promedio por año, y quisiéramos una tabla que separara las medidas de popularidad en una columna y el ranking promedio en otra, podemos hacerlo de la siguiente manera:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forma 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>colA <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"daily_rank."</span>, <span class="dv">2023</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>colB <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"popularity."</span>, <span class="dv">2023</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pop_rank_year_long <span class="ot">&lt;-</span> pop_rank_per_year <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>(., <span class="at">measure =</span> <span class="fu">list</span>(colA, colB), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">"daily_rank"</span>, <span class="st">"popularity"</span>), <span class="at">variable.name =</span> <span class="st">"year"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pop_rank_year_long[,year <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">2023</span>,<span class="dv">2024</span>)]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pop_rank_year_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       country                                                                 name  year daily_rank popularity
        &lt;char&gt;                                                               &lt;char&gt; &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
    1:      AE                        ""Slut!"" (Taylor's Version) (From The Vault)  2023       28.7       85.4
    2:      AE                                         (It Goes Like) Nanana - Edit  2023        NaN        NaN
    3:      AE                                                            100 Bands  2023        NaN        NaN
    4:      AE                                                                   22  2023        NaN        NaN
    5:      AE                                                               3 Days  2023        NaN        NaN
   ---                                                                                                         
59050:      ZA uKhome Lotto (feat. Agzo, Optimist Music ZA, Seun1401 &amp; El.Stephano)  2024       42.0       55.3
59051:      ZA                        uLala Kanjani (feat. LeeMcKrazy &amp; Skandisoul)  2024        NaN        NaN
59052:      ZA                             we can't be friends (wait for your love)  2024       33.3       91.5
59053:      ZA                                                    whatsapp (wassam)  2024       42.0        0.0
59054:      ZA                                                            yes, and?  2024       30.5       84.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forma 2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pop_rank_per_year <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>(., <span class="at">measure =</span> <span class="fu">patterns</span>(<span class="st">"^daily_rank."</span>, <span class="st">"^popularity."</span>), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">"daily_rank"</span>, <span class="st">"popularity"</span>), <span class="at">variable.name =</span> <span class="st">"year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       country                                                                 name   year daily_rank popularity
        &lt;char&gt;                                                               &lt;char&gt; &lt;fctr&gt;      &lt;num&gt;      &lt;num&gt;
    1:      AE                        ""Slut!"" (Taylor's Version) (From The Vault)      1       28.7       85.4
    2:      AE                                         (It Goes Like) Nanana - Edit      1        NaN        NaN
    3:      AE                                                            100 Bands      1        NaN        NaN
    4:      AE                                                                   22      1        NaN        NaN
    5:      AE                                                               3 Days      1        NaN        NaN
   ---                                                                                                          
59050:      ZA uKhome Lotto (feat. Agzo, Optimist Music ZA, Seun1401 &amp; El.Stephano)      2       42.0       55.3
59051:      ZA                        uLala Kanjani (feat. LeeMcKrazy &amp; Skandisoul)      2        NaN        NaN
59052:      ZA                             we can't be friends (wait for your love)      2       33.3       91.5
59053:      ZA                                                    whatsapp (wassam)      2       42.0        0.0
59054:      ZA                                                            yes, and?      2       30.5       84.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forma 3</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>pop_rank_per_year <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">melt</span>(., <span class="at">measure.vars =</span> <span class="fu">measure</span>(<span class="at">var=</span>as.factor, <span class="at">year=</span>as.integer, <span class="at">sep=</span><span class="st">"."</span>), <span class="at">value.name =</span> <span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        country                                                                 name        var  year  mean
         &lt;char&gt;                                                               &lt;char&gt;     &lt;fctr&gt; &lt;int&gt; &lt;num&gt;
     1:      AE                        ""Slut!"" (Taylor's Version) (From The Vault) daily_rank  2023  28.7
     2:      AE                                         (It Goes Like) Nanana - Edit daily_rank  2023   NaN
     3:      AE                                                            100 Bands daily_rank  2023   NaN
     4:      AE                                                                   22 daily_rank  2023   NaN
     5:      AE                                                               3 Days daily_rank  2023   NaN
    ---                                                                                                    
118104:      ZA uKhome Lotto (feat. Agzo, Optimist Music ZA, Seun1401 &amp; El.Stephano) popularity  2024  55.3
118105:      ZA                        uLala Kanjani (feat. LeeMcKrazy &amp; Skandisoul) popularity  2024   NaN
118106:      ZA                             we can't be friends (wait for your love) popularity  2024  91.5
118107:      ZA                                                    whatsapp (wassam) popularity  2024   0.0
118108:      ZA                                                            yes, and? popularity  2024  84.0</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>