{
  "hash": "88f4ab67efc8c26d3a120e5b7782ad30",
  "result": {
    "markdown": "---\ntitle: \"Agrupación y cadenas de operaciones\"\nformat: \n  html:\n    page-layout: full \n---\n\n\nAhora continuaremos usando el dataset de las plantas para sacar datos considerando agrupaciones. \nPor ejemplo podemos estimar cuántas veces aparece una canción entre las top 50.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,.N,by = name]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                            name     N\n                          <char> <int>\n    1:          Die With A Smile  1145\n    2:        BIRDS OF A FEATHER  5515\n    3:                     Taste   674\n    4:                  Espresso  6972\n    5:                       Who  1965\n   ---                                \n13332:                     Tsiou     2\n13333:              Mexri Telous     2\n13334:           Virtuální drogy     2\n13335: AMBIENTE ERRADO - Ao Vivo     2\n13336:     Oficializar - Ao Vivo     2\n```\n:::\n:::\n\n\n\nSe pueden usar múltiples factores en las agrupaciones. Por ejemplo, cuantas veces aparece una canción de su album particular por pais.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntimes_song_per_album_per_country <- data[,.N,by = .(album_name,name,country)] \n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Genera una tabla en la que calcules el número de paises en el que un album estuvo en el top 50\n2. Haz una gráfica para visualizar los resultados\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nsongs_per_album_per_country <- times_song_per_album_per_country[,.(n_songs = .N),by = .(album_name,country)]\n\ncountries_per_album <- songs_per_album_per_country[,.(n_countries = .N), by = album_name] \n\ncountries_per_album %>% \n  ggplot(aes(x = n_countries))+\n    geom_histogram(bins = 50)+\n    theme_bw()\n```\n\n::: {.cell-output-display}\n![](tema5_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n:::\n\n## Cadenas de operaciones\n\nUna función muy importante del paquete es la capacidad de encadenar operaciones en un mismo comando sin necesidad de guardar el resultado en algun objeto. \n\nEs una función similar al uso del pipe `%>%` o `|>` en tidyverse o rbase. En data table se pueden evaluar una serie de expresiones una después de la otra escribiendolas entre corchetes de esta manera:\n\n```\nDT[ ... ][ ... ][ ... ]\n```\no de forma vertical\n\n```\nDT[ ...\n   ][ ...\n     ][ ...\n       ]\n```\n\nPor ejemplo, recapitulando temas anteriores ¿cómo contarías el número de paises en los que una canción ha estado en el top 50?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata[,.N, by = .(name,country)][,.(ncountry = .N), by = name]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                            name ncountry\n                          <char>    <int>\n    1:          Die With A Smile       61\n    2:        BIRDS OF A FEATHER       62\n    3:                     Taste       49\n    4:                  Espresso       62\n    5:                       Who       48\n   ---                                   \n13332:                     Tsiou        1\n13333:              Mexri Telous        1\n13334:           Virtuální drogy        1\n13335: AMBIENTE ERRADO - Ao Vivo        1\n13336:     Oficializar - Ao Vivo        1\n```\n:::\n:::\n\n\n\nEn realidad los corchetes consecutivos es una funcionalidad que viene desde R base. Por ejemplo, podemos seleccionar las primeras 10 filas del df data y después seleccionar las primeras dos. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas.data.frame(data)[1:10,][1:2,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              spotify_id               name               artists daily_rank daily_movement weekly_movement country\n1 2plbrEY59IikOBgBGLjaoe   Die With A Smile Lady Gaga, Bruno Mars          1              0               0        \n2 6dOtVTDdiauQNBQEDOtlAB BIRDS OF A FEATHER         Billie Eilish          2              0               0        \n  snapshot_date popularity is_explicit duration_ms           album_name album_release_date danceability energy key\n1    2024-09-08         97       FALSE      251667     Die With A Smile         2024-08-16        0.521  0.592   6\n2    2024-09-08        100       FALSE      210373 HIT ME HARD AND SOFT         2024-05-17        0.747  0.507   2\n  loudness mode speechiness acousticness instrumentalness liveness valence   tempo time_signature\n1   -7.777    0      0.0304        0.308           0.0000    0.122   0.535 157.969              3\n2  -10.171    1      0.0358        0.200           0.0608    0.117   0.438 104.978              4\n```\n:::\n:::",
    "supporting": [
      "tema5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}