{"title":"Agrupación y cadenas de operaciones","markdown":{"yaml":{"title":"Agrupación y cadenas de operaciones","format":{"html":{"page-layout":"full"}}},"headingText":"Ejercicio","containsRefs":false,"markdown":"\n\nAhora continuaremos usando el dataset de las plantas para sacar datos considerando agrupaciones. \nPor ejemplo podemos estimar cuántas veces aparece una canción entre las top 50.\n\n```{r}\n#| echo: false\nlibrary(data.table)\nlibrary(magrittr)\nlibrary(ggplot2)\n\ndata = fread(\"data/universal_top_spotify_songs.csv.gz\")\n```\n\n```{r}\ndata[,.N,by = name]\n```\n\n\nSe pueden usar múltiples factores en las agrupaciones. Por ejemplo, cuantas veces aparece una canción de su album particular por pais.\n\n```{r}\ntimes_song_per_album_per_country <- data[,.N,by = .(album_name,name,country)] \n\n```\n\n::: {.callout-note collapse=\"true\"}\n\n1. Genera una tabla en la que calcules el número de paises en el que un album estuvo en el top 50\n2. Haz una gráfica para visualizar los resultados\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n```{r}\n#| code-fold: true\n#| echo: false\nsongs_per_album_per_country <- times_song_per_album_per_country[,.(n_songs = .N),by = .(album_name,country)]\n\ncountries_per_album <- songs_per_album_per_country[,.(n_countries = .N), by = album_name] \n\ncountries_per_album %>% \n  ggplot(aes(x = n_countries))+\n    geom_histogram(bins = 50)+\n    theme_bw()\n```\n\n:::\n\n## Agrupación por expresión \n\nEl espacio `by` también nos permite formar los grupos directamente de una expresión. Por ejemplo, si quisieramos contar el número de canciones en cada pais que tienen una popularidad mayor a 80.\n\n```{r}\ndata[,.N,by = .(country,PopAbove80 = popularity > 80)] %>% head()\n```\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nCalcula cuántas veces una canción ha sido ranqueada como la número 1 (para cualquier pais). Muestra las 5 canciones que hayan tenido el ranking 1 más veces.\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n```{r}\n#| code-fold: true\n#| echo: false\n\nfreq_num1 <- data[,.N,by = .(name,num1 = daily_rank == 1)]\nfreq_num1[num1 == T] %>% .[order(-N)] %>% .[1:5]\n\n```\n\n:::\n\n## Cadenas de operaciones\n\nUna función muy importante del paquete es la capacidad de encadenar operaciones en un mismo comando sin necesidad de guardar el resultado en algun objeto. \n\nEs una función que se puede entender de manera similar al uso del pipe `%>%` o `|>` en tidyverse o rbase. En data table se pueden evaluar una serie de expresiones una después de la otra escribiendolas entre corchetes de esta manera:\n\n```\nDT[ ... ][ ... ][ ... ]\n```\no de forma vertical\n\n```\nDT[ ...\n   ][ ...\n     ][ ...\n       ]\n```\n\nPor ejemplo, recapitulando temas anteriores ¿cómo contarías el número de paises en los que una canción ha estado en el top 50?\n\n```{r}\n\ndata[,.N, by = .(name,country)][,.(ncountry = .N), by = name]\n\n```\n\n\nEn realidad los corchetes consecutivos es una funcionalidad que viene desde R base. Por ejemplo, podemos seleccionar las primeras 10 filas del df data y después seleccionar las primeras dos. \n\n\n```{r}\n\nas.data.frame(data)[1:10,][1:2,]\n\n```","srcMarkdownNoYaml":"\n\nAhora continuaremos usando el dataset de las plantas para sacar datos considerando agrupaciones. \nPor ejemplo podemos estimar cuántas veces aparece una canción entre las top 50.\n\n```{r}\n#| echo: false\nlibrary(data.table)\nlibrary(magrittr)\nlibrary(ggplot2)\n\ndata = fread(\"data/universal_top_spotify_songs.csv.gz\")\n```\n\n```{r}\ndata[,.N,by = name]\n```\n\n\nSe pueden usar múltiples factores en las agrupaciones. Por ejemplo, cuantas veces aparece una canción de su album particular por pais.\n\n```{r}\ntimes_song_per_album_per_country <- data[,.N,by = .(album_name,name,country)] \n\n```\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Genera una tabla en la que calcules el número de paises en el que un album estuvo en el top 50\n2. Haz una gráfica para visualizar los resultados\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n```{r}\n#| code-fold: true\n#| echo: false\nsongs_per_album_per_country <- times_song_per_album_per_country[,.(n_songs = .N),by = .(album_name,country)]\n\ncountries_per_album <- songs_per_album_per_country[,.(n_countries = .N), by = album_name] \n\ncountries_per_album %>% \n  ggplot(aes(x = n_countries))+\n    geom_histogram(bins = 50)+\n    theme_bw()\n```\n\n:::\n\n## Agrupación por expresión \n\nEl espacio `by` también nos permite formar los grupos directamente de una expresión. Por ejemplo, si quisieramos contar el número de canciones en cada pais que tienen una popularidad mayor a 80.\n\n```{r}\ndata[,.N,by = .(country,PopAbove80 = popularity > 80)] %>% head()\n```\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nCalcula cuántas veces una canción ha sido ranqueada como la número 1 (para cualquier pais). Muestra las 5 canciones que hayan tenido el ranking 1 más veces.\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n```{r}\n#| code-fold: true\n#| echo: false\n\nfreq_num1 <- data[,.N,by = .(name,num1 = daily_rank == 1)]\nfreq_num1[num1 == T] %>% .[order(-N)] %>% .[1:5]\n\n```\n\n:::\n\n## Cadenas de operaciones\n\nUna función muy importante del paquete es la capacidad de encadenar operaciones en un mismo comando sin necesidad de guardar el resultado en algun objeto. \n\nEs una función que se puede entender de manera similar al uso del pipe `%>%` o `|>` en tidyverse o rbase. En data table se pueden evaluar una serie de expresiones una después de la otra escribiendolas entre corchetes de esta manera:\n\n```\nDT[ ... ][ ... ][ ... ]\n```\no de forma vertical\n\n```\nDT[ ...\n   ][ ...\n     ][ ...\n       ]\n```\n\nPor ejemplo, recapitulando temas anteriores ¿cómo contarías el número de paises en los que una canción ha estado en el top 50?\n\n```{r}\n\ndata[,.N, by = .(name,country)][,.(ncountry = .N), by = name]\n\n```\n\n\nEn realidad los corchetes consecutivos es una funcionalidad que viene desde R base. Por ejemplo, podemos seleccionar las primeras 10 filas del df data y después seleccionar las primeras dos. \n\n\n```{r}\n\nas.data.frame(data)[1:10,][1:2,]\n\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"tema5.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","knitr":{"opts_chunk":{"R.options":{"width":120}}},"theme":"flatly","code-wrap":true,"page-layout":"full","code-block-style":"line-wrap","grid":{"body-width":"1100px","sidebar-width":"250px","margin-width":"150px","gutter-width":"0.8em"},"title":"Agrupación y cadenas de operaciones"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}