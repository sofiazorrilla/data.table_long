{"title":"Modificación de columnas","markdown":{"yaml":{"title":"Modificación de columnas","format":{"html":{"page-layout":"full"}}},"headingText":"Operaciones en j","containsRefs":false,"markdown":"\n\n```{r}\n#| echo: false\nlibrary(data.table)\nlibrary(magrittr)\ndata = fread(\"data/universal_top_spotify_songs.csv\")\n```\n\n\n\n\ndata.table nos permite efectuar operaciones sobre las columnas, por ejemplo, contar cuántas coincidencias tenemos para nuestros criterios aplicados.\n\n```{r}\ndata[country == \"MX\" & acousticness > 0.5, length(spotify_id)]\n\ndata[country == \"MX\" & acousticness > 0.5, .N]\n```\n\nExisten símbolos especiales como .N que nos cuenta el número de observaciones que cumplen nuestros criterios para el número de grupos que hemos definido. En este caso todas las observaciones pertenecen al mismo grupo.\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nPregunta:\n¿Cuántas canciones que se hayan publicado de antes del 2000 han estado dentro del top 50? (Utiliza .N)\n::: \n\n::: {.callout-note collapse=\"true\"}\n\n## Respuesta\n```{r}\ndata[album_release_date<2000,.N]\n```\n:::\n \n\nPor ejemplo si quisieramos saber el promedio de duración en minutos de las canciones\n\n```{r}\ndata[, duration_ms/1000/60] %>% mean()\n\n\ndata[,mean(duration_ms/1000/60)]\n\n```\n\nAdemás podemos combinar filtros sobre las filas y acciones sobre las columnas. Por ejemplo, si queremos calcular el promedio de popularidad de las canciones en el top 50 de México. Primero hacemos un filtro de las canciones populares en México y después obtenemos el promedio de popularidad únicamente de estas filas.\n\n>> Nota: La popularidad de una canción es un valor entre 0 y 100, donde 100 indica la mayor popularidad. La popularidad se calcula mediante un algoritmo y se basa, en su mayoría, en el número total de reproducciones que ha tenido la canción y en cuán recientes han sido esas reproducciones.\nEn términos generales, las canciones que se reproducen mucho actualmente tendrán una popularidad mayor que las canciones que se reprodujeron mucho en el pasado. Las canciones duplicadas (por ejemplo, la misma canción de un sencillo y de un álbum) se califican de manera independiente. La popularidad de los artistas y los álbumes se deriva matemáticamente de la popularidad de las canciones. Nota: el valor de popularidad puede no reflejar la popularidad real en algunos días, ya que no se actualiza en tiempo real.\n\n```{r}\ndata[country == \"MX\", mean(popularity)]\n```\n\nDebido a que tanto el filtro como la función sobre la columna están en el mismo comando, data.table sabe el total de las operaciones y puede hacer más eficiente la velocidad y el uso de la memoria cuando las ejecuta.\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nCalcula el promedio y desviación estandar en los movimientos diarios de ranking (el cambio en las clasificaciones en comparación con el día anterior) en las canciones populares de México. \n\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n\n```{r}\n#| code-fold: true\ndata[country == \"MX\",\n        c(mean(daily_movement), sd(daily_movement))]\n```\n\n::: \n\n## Agregar nuevas columnas a nuestro data.table \n\nHasta ahora estabamos aplicando funciones y obtuvimos vectores o números como resultado pero podemos utilizar el espacio j para crear nuevas columnas en nuestras tablas. Por ejemplo, podemos guardar la duración de cada canción en minutos. \n\n```{r}\n data[, .(duration_min = duration_ms/1000/60)]\n```\n\n\nAhora qué sucede si queremos generar la nueva columna dentro de nuestra tabla original. Por ejemplo si estimamos la diferencia en tiempo desde que el album fue publicado y la fecha en la que apareció entre el top 50\n\n**Nota:** El operador `:=` sirve para modificar tablas guardadas en la memoria directamente (modify in place)\n\n```{r}\ndata[, date_dif := snapshot_date - album_release_date]\n\ndata\n\n```\n\nPara agregar múltiples columnas en la tabla original se utiliza la siguientes sintaxis \n\n```\ndt[,`:=`(col1 = funcion, col2 = funcion)]\n\ndt[, c(\"col1\",\"col2\",\"col3\") := list(val1,val2,val3)]\n```\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Agrega una nueva columna (`year_release`) a la tabla original que solo muestre el año de publicación del album de la canción\n\n2. En un solo comando: genera una columna de diferencia entre la fecha de publicación y la fecha en la que la canción apareció en el top50. Además generar una columna de duración de la canción en minutos\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n### Ejercicio 1 \n```{r}\n#| code-fold: true\n\n# Ejercicio 1\ndata[, year_release := format(album_release_date, \"%Y\")]\n\ncolnames(data)\nhead(data[,.(year_release)])\n\n```\n\n### Ejercicio 2\n```{r}\n#| code-fold: true\n\n\n# Ejercicio 2\n\ndata[, c(\"days_until_top50\",\"duration_min\") := .(snapshot_date-album_release_date, duration_ms/1000/60)]\n\ncolnames(data)\ndata[,.(days_until_top50,duration_min)]\n```\n::: \n\n\n<!-- ## Indices\n\n```{.r}\nsetkeyv(data,\"country\")\n\ndata[\"Mexico\"]\n\ndata[\"Mexico\", nomatch = NULL]\n\ndata[country == \"Mexico\"]\n\ndata[,.N]\n``` -->\n\n\n","srcMarkdownNoYaml":"\n\n```{r}\n#| echo: false\nlibrary(data.table)\nlibrary(magrittr)\ndata = fread(\"data/universal_top_spotify_songs.csv\")\n```\n\n\n\n### Operaciones en j\n\ndata.table nos permite efectuar operaciones sobre las columnas, por ejemplo, contar cuántas coincidencias tenemos para nuestros criterios aplicados.\n\n```{r}\ndata[country == \"MX\" & acousticness > 0.5, length(spotify_id)]\n\ndata[country == \"MX\" & acousticness > 0.5, .N]\n```\n\nExisten símbolos especiales como .N que nos cuenta el número de observaciones que cumplen nuestros criterios para el número de grupos que hemos definido. En este caso todas las observaciones pertenecen al mismo grupo.\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nPregunta:\n¿Cuántas canciones que se hayan publicado de antes del 2000 han estado dentro del top 50? (Utiliza .N)\n::: \n\n::: {.callout-note collapse=\"true\"}\n\n## Respuesta\n```{r}\ndata[album_release_date<2000,.N]\n```\n:::\n \n\nPor ejemplo si quisieramos saber el promedio de duración en minutos de las canciones\n\n```{r}\ndata[, duration_ms/1000/60] %>% mean()\n\n\ndata[,mean(duration_ms/1000/60)]\n\n```\n\nAdemás podemos combinar filtros sobre las filas y acciones sobre las columnas. Por ejemplo, si queremos calcular el promedio de popularidad de las canciones en el top 50 de México. Primero hacemos un filtro de las canciones populares en México y después obtenemos el promedio de popularidad únicamente de estas filas.\n\n>> Nota: La popularidad de una canción es un valor entre 0 y 100, donde 100 indica la mayor popularidad. La popularidad se calcula mediante un algoritmo y se basa, en su mayoría, en el número total de reproducciones que ha tenido la canción y en cuán recientes han sido esas reproducciones.\nEn términos generales, las canciones que se reproducen mucho actualmente tendrán una popularidad mayor que las canciones que se reprodujeron mucho en el pasado. Las canciones duplicadas (por ejemplo, la misma canción de un sencillo y de un álbum) se califican de manera independiente. La popularidad de los artistas y los álbumes se deriva matemáticamente de la popularidad de las canciones. Nota: el valor de popularidad puede no reflejar la popularidad real en algunos días, ya que no se actualiza en tiempo real.\n\n```{r}\ndata[country == \"MX\", mean(popularity)]\n```\n\nDebido a que tanto el filtro como la función sobre la columna están en el mismo comando, data.table sabe el total de las operaciones y puede hacer más eficiente la velocidad y el uso de la memoria cuando las ejecuta.\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\nCalcula el promedio y desviación estandar en los movimientos diarios de ranking (el cambio en las clasificaciones en comparación con el día anterior) en las canciones populares de México. \n\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n\n```{r}\n#| code-fold: true\ndata[country == \"MX\",\n        c(mean(daily_movement), sd(daily_movement))]\n```\n\n::: \n\n## Agregar nuevas columnas a nuestro data.table \n\nHasta ahora estabamos aplicando funciones y obtuvimos vectores o números como resultado pero podemos utilizar el espacio j para crear nuevas columnas en nuestras tablas. Por ejemplo, podemos guardar la duración de cada canción en minutos. \n\n```{r}\n data[, .(duration_min = duration_ms/1000/60)]\n```\n\n\nAhora qué sucede si queremos generar la nueva columna dentro de nuestra tabla original. Por ejemplo si estimamos la diferencia en tiempo desde que el album fue publicado y la fecha en la que apareció entre el top 50\n\n**Nota:** El operador `:=` sirve para modificar tablas guardadas en la memoria directamente (modify in place)\n\n```{r}\ndata[, date_dif := snapshot_date - album_release_date]\n\ndata\n\n```\n\nPara agregar múltiples columnas en la tabla original se utiliza la siguientes sintaxis \n\n```\ndt[,`:=`(col1 = funcion, col2 = funcion)]\n\ndt[, c(\"col1\",\"col2\",\"col3\") := list(val1,val2,val3)]\n```\n\n\n::: {.callout-note collapse=\"true\"}\n## Ejercicio\n\n1. Agrega una nueva columna (`year_release`) a la tabla original que solo muestre el año de publicación del album de la canción\n\n2. En un solo comando: genera una columna de diferencia entre la fecha de publicación y la fecha en la que la canción apareció en el top50. Además generar una columna de duración de la canción en minutos\n\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n### Ejercicio 1 \n```{r}\n#| code-fold: true\n\n# Ejercicio 1\ndata[, year_release := format(album_release_date, \"%Y\")]\n\ncolnames(data)\nhead(data[,.(year_release)])\n\n```\n\n### Ejercicio 2\n```{r}\n#| code-fold: true\n\n\n# Ejercicio 2\n\ndata[, c(\"days_until_top50\",\"duration_min\") := .(snapshot_date-album_release_date, duration_ms/1000/60)]\n\ncolnames(data)\ndata[,.(days_until_top50,duration_min)]\n```\n::: \n\n\n<!-- ## Indices\n\n```{.r}\nsetkeyv(data,\"country\")\n\ndata[\"Mexico\"]\n\ndata[\"Mexico\", nomatch = NULL]\n\ndata[country == \"Mexico\"]\n\ndata[,.N]\n``` -->\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"tema4.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","knitr":{"opts_chunk":{"R.options":{"width":120}}},"theme":"flatly","code-wrap":true,"grid":{"body-width":"1000px"},"title":"Modificación de columnas","page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}