{"title":"Filtros y selección de columnas","markdown":{"yaml":{"title":"Filtros y selección de columnas","format":{"html":{"page-layout":"full"}}},"headingText":"Operaciones sobre las filas","containsRefs":false,"markdown":"\n\n```{r}\n#| echo: false\n#| warning: false\n\nlibrary(tidyverse)\nlibrary(data.table)\n```\n\n\n## Seleccionar por índices\n\nSimilar a como se seleccionan filas en un data.frame, en un objeto data.table se pueden seleccionar filas utilizando rangos de índices. En los siguientes dos ejemplos se muestra como seleccionar las primeras dos filas de la tabla de registros. \n\n\n```{r}\n#| echo: false\n#| warning: false\n\ndata = fread(\"data/universal_top_spotify_songs.csv.gz\")\n```\n\n```{.r}\nlibrary(data.table)\n\ndata <- fread(\"data/universal_top_spotify_songs.csv\")\n```\n\n```{r}\ndata[1:2,] \n```\n\n<br>\n\n**Nota:** Cuando solo estamos seleccionando filas no es necesario incluir la coma al final.\n\n```{r}\ndata[1:2] \n```\n\n<br>\n\n## Filtrar filas\n\nDe acuerdo con la sintaxis del paquete, el espacio i es el lugar en el que se pueden realizar operaciones sobre las filas como los filtros. Por ejemplo, utilizando la tabla de canciones podríamos estar interesados en solo seleccionar aquellos registros que pertenezcan a México. \n\n\n```{r}\n\ndata_MX <- data[country == \"MX\",] \n\ndim(data_MX)\n\n```\n\nO podríamos estar interesadas en seleccionar solo los registros más viejos, los que fueron publicados antes del 2000. \n\n```{r}\ndata_MX_viejos <- data[country == \"MX\" & album_release_date <= 2000,]\n\ndim(data_MX_viejos)\n```\n\nOperadores lógicos para hacer los filtros:\n\n|  Operador |          Comparación         |    Ejemplo    | Resultado |\n|:---------:|:----------------------------:|:-------------:|:---------:|\n| x \\| y    | x Ó y es verdadero           | TRUE \\| FALSE | TRUE      |\n| x & y     | x Y y son verdaderos         | TRUE & FALSE  | FALSE     |\n| !x        | x no es verdadero (negación) | !TRUE         | FALSE     |\n| isTRUE(x) | x es verdadero (afirmación)  | isTRUE(TRUE)  | TRUE      |\n\n<br>\n\n## Ordenar filas\n\nOtra función que se puede realizar en el espacio de las filas es ordenarlas. Por ejemplo, podríamos ordenar la tabla de canciones de México por qué tan bailable es.\n\n```{r}\n# Ordenar los datos de la tabla por qué tan bailable es\n\nordered_data_MX = data_MX[order(danceability, decreasing = T)]\n\n# seleccionar la columna de danceability como vector y seleccionar los valores únicos\n# mostrar solo los primeros valores\n\nunique(ordered_data_MX$danceability) |> head()\n```\n\n::: {.callout-note collapse=\"true\"}\n## Reto\n\n1. Carga el archivo de canciones utilizando la función fread que revisamos en el tema anterior\n2. Utiliza un filtro para quedarte con las filas que pertenezcan al pais que te interese\n3. Ordena de manera descendente por ranking\n\nPregunta:\n\n¿De qué rango de años son las 50 canciones más escuchadas?\n\nNota: Cuando tienes una columna de fecha con formato Año-mes-dia pero solo quieres la información de alguno de los elementos (por ejemplo el año) puedes utilizar la siguiente función: `format(data_MX_ordenado$album_release_date,\"%Y\")`\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n```{r}\n#| code-fold: true\n#| echo: false\n\ndata_MX_ordenado <- data_MX[order(-daily_rank)] \n\nyears <- format(data_MX_ordenado$album_release_date,\"%Y\")\n\nprint(paste(\"Mexico:\",min(years),\"-\",max(years)))\n```\n:::\n\n<br>\n<br>\n\n# Operaciones sobre las columnas\n\n## Seleccionar columnas por índice\n\nDe acuerdo con la sintaxis del paquete, el espacio j nos permite realizar operaciones sobre las columnas. Una de esas operaciones es la selección de columnas. \n\nSe pueden seleccionar por medio de índices:\n\n```{r}\ndata[,c(2,3,7),]\n```\n\n\n## Seleccionar columnas por nombre\n\nSe pueden seleccionar las columas por nombre y regresar como vector:\n\n```{r}\ndata[,name] |> head()\n```\n\nSe pueden seleccionar las columnas usando una lista y regresar como tabla:\n\n```{r}\ndata[,list(artists,name,album_name)]\n```\n\nUn atajo para no escribir `list()` es `.()`:\n\n```{r}\ndata[,.(artists,name,album_name)]\n```\n\nSeleccionar columnas por rangos usando nombres:\n\n```{r}\ndata[,spotify_id:weekly_movement]\n```\n\nPara seleccionar columnas guardadas en una variable se puede utilizar el prefijo `..`:\n\n```{r}\nvariables <- c(\"artists\",\"name\",\"album_name\")\n\ndata[ , ..variables]\n```\n\nNota: Tanto los objetos data.frame como los data.table son listas (aun cuando las vemos como tablas). El hecho de que las operaciones realizadas en el espacio j regresen listas es muy poderoso y permite hacer operaciones más complicadas más adelante.\n\n::: {.callout-note collapse=\"true\"}\n## Reto\n\nA. Me gustaría tener un data frame en donde solo tuviera la información de las características de las canciones (por ejemplo: duración, energía, etc.)\n\n  1. Enlista los nombres de columnas y analiza de qué tratan \n  2. Guarda los nombres de las columnas que solo contengan información acerca las características  en un objeto\n  3. Selecciona las columnas de la tabla data usando el objeto de nombres de columnas. \n\nB. Genera un objeto data.table que tenga los registros del mes de septiembre 2024 y las columnas que describen las características de las cancions (utiliza un solo comando).\n\nNota: Cuando tienes una columna de fecha con formato Año-mes-dia pero solo quieres la información de algunos de los elementos (por ejemplo el año y mes) puedes utilizar la siguiente función: `format(data_MX_ordenado$album_release_date,\"%Y-%m\")`\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\ninfo_canciones <- c(\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\n```{r}\n#| code-fold: true\n#| echo: false\n\ninfo_canciones <- c(\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\ndata[,..info_canciones,]\n\ninfo_canciones2 <- c(\"snapshot_date\",\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\ndata[format(snapshot_date, \"%Y-%m\") == \"2024-09\" , ..info_canciones2]\n```\n\n:::\n\n## Deseleccionar columas\n\nSimilar a las formas de seleccionar columnas podemos utilizar los operadores `-` y `!` para evitar la selección de ciertas columnas o rangos de columnas.\n\n```{r}\ndata[,-c(\"name\",\"artists\")] %>% colnames()\n\ndata[,!c(\"spotify_id\")] %>% colnames()\n\ndata[,!(key:time_signature)] %>% colnames()\n```\n\n## Renombrar columnas\n\nEn el espacio de operaciones sobre las columnas también se pueden renombrar las columnas. \n\n```{r}\ndata[, .(artista = artists, song_name = name)]\n```\n\n\n","srcMarkdownNoYaml":"\n\n```{r}\n#| echo: false\n#| warning: false\n\nlibrary(tidyverse)\nlibrary(data.table)\n```\n\n# Operaciones sobre las filas\n\n## Seleccionar por índices\n\nSimilar a como se seleccionan filas en un data.frame, en un objeto data.table se pueden seleccionar filas utilizando rangos de índices. En los siguientes dos ejemplos se muestra como seleccionar las primeras dos filas de la tabla de registros. \n\n\n```{r}\n#| echo: false\n#| warning: false\n\ndata = fread(\"data/universal_top_spotify_songs.csv.gz\")\n```\n\n```{.r}\nlibrary(data.table)\n\ndata <- fread(\"data/universal_top_spotify_songs.csv\")\n```\n\n```{r}\ndata[1:2,] \n```\n\n<br>\n\n**Nota:** Cuando solo estamos seleccionando filas no es necesario incluir la coma al final.\n\n```{r}\ndata[1:2] \n```\n\n<br>\n\n## Filtrar filas\n\nDe acuerdo con la sintaxis del paquete, el espacio i es el lugar en el que se pueden realizar operaciones sobre las filas como los filtros. Por ejemplo, utilizando la tabla de canciones podríamos estar interesados en solo seleccionar aquellos registros que pertenezcan a México. \n\n\n```{r}\n\ndata_MX <- data[country == \"MX\",] \n\ndim(data_MX)\n\n```\n\nO podríamos estar interesadas en seleccionar solo los registros más viejos, los que fueron publicados antes del 2000. \n\n```{r}\ndata_MX_viejos <- data[country == \"MX\" & album_release_date <= 2000,]\n\ndim(data_MX_viejos)\n```\n\nOperadores lógicos para hacer los filtros:\n\n|  Operador |          Comparación         |    Ejemplo    | Resultado |\n|:---------:|:----------------------------:|:-------------:|:---------:|\n| x \\| y    | x Ó y es verdadero           | TRUE \\| FALSE | TRUE      |\n| x & y     | x Y y son verdaderos         | TRUE & FALSE  | FALSE     |\n| !x        | x no es verdadero (negación) | !TRUE         | FALSE     |\n| isTRUE(x) | x es verdadero (afirmación)  | isTRUE(TRUE)  | TRUE      |\n\n<br>\n\n## Ordenar filas\n\nOtra función que se puede realizar en el espacio de las filas es ordenarlas. Por ejemplo, podríamos ordenar la tabla de canciones de México por qué tan bailable es.\n\n```{r}\n# Ordenar los datos de la tabla por qué tan bailable es\n\nordered_data_MX = data_MX[order(danceability, decreasing = T)]\n\n# seleccionar la columna de danceability como vector y seleccionar los valores únicos\n# mostrar solo los primeros valores\n\nunique(ordered_data_MX$danceability) |> head()\n```\n\n::: {.callout-note collapse=\"true\"}\n## Reto\n\n1. Carga el archivo de canciones utilizando la función fread que revisamos en el tema anterior\n2. Utiliza un filtro para quedarte con las filas que pertenezcan al pais que te interese\n3. Ordena de manera descendente por ranking\n\nPregunta:\n\n¿De qué rango de años son las 50 canciones más escuchadas?\n\nNota: Cuando tienes una columna de fecha con formato Año-mes-dia pero solo quieres la información de alguno de los elementos (por ejemplo el año) puedes utilizar la siguiente función: `format(data_MX_ordenado$album_release_date,\"%Y\")`\n::: \n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\n```{r}\n#| code-fold: true\n#| echo: false\n\ndata_MX_ordenado <- data_MX[order(-daily_rank)] \n\nyears <- format(data_MX_ordenado$album_release_date,\"%Y\")\n\nprint(paste(\"Mexico:\",min(years),\"-\",max(years)))\n```\n:::\n\n<br>\n<br>\n\n# Operaciones sobre las columnas\n\n## Seleccionar columnas por índice\n\nDe acuerdo con la sintaxis del paquete, el espacio j nos permite realizar operaciones sobre las columnas. Una de esas operaciones es la selección de columnas. \n\nSe pueden seleccionar por medio de índices:\n\n```{r}\ndata[,c(2,3,7),]\n```\n\n\n## Seleccionar columnas por nombre\n\nSe pueden seleccionar las columas por nombre y regresar como vector:\n\n```{r}\ndata[,name] |> head()\n```\n\nSe pueden seleccionar las columnas usando una lista y regresar como tabla:\n\n```{r}\ndata[,list(artists,name,album_name)]\n```\n\nUn atajo para no escribir `list()` es `.()`:\n\n```{r}\ndata[,.(artists,name,album_name)]\n```\n\nSeleccionar columnas por rangos usando nombres:\n\n```{r}\ndata[,spotify_id:weekly_movement]\n```\n\nPara seleccionar columnas guardadas en una variable se puede utilizar el prefijo `..`:\n\n```{r}\nvariables <- c(\"artists\",\"name\",\"album_name\")\n\ndata[ , ..variables]\n```\n\nNota: Tanto los objetos data.frame como los data.table son listas (aun cuando las vemos como tablas). El hecho de que las operaciones realizadas en el espacio j regresen listas es muy poderoso y permite hacer operaciones más complicadas más adelante.\n\n::: {.callout-note collapse=\"true\"}\n## Reto\n\nA. Me gustaría tener un data frame en donde solo tuviera la información de las características de las canciones (por ejemplo: duración, energía, etc.)\n\n  1. Enlista los nombres de columnas y analiza de qué tratan \n  2. Guarda los nombres de las columnas que solo contengan información acerca las características  en un objeto\n  3. Selecciona las columnas de la tabla data usando el objeto de nombres de columnas. \n\nB. Genera un objeto data.table que tenga los registros del mes de septiembre 2024 y las columnas que describen las características de las cancions (utiliza un solo comando).\n\nNota: Cuando tienes una columna de fecha con formato Año-mes-dia pero solo quieres la información de algunos de los elementos (por ejemplo el año y mes) puedes utilizar la siguiente función: `format(data_MX_ordenado$album_release_date,\"%Y-%m\")`\n\n:::\n\n::: {.callout-note collapse=\"true\"}\n## Respuesta\n\ninfo_canciones <- c(\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\n```{r}\n#| code-fold: true\n#| echo: false\n\ninfo_canciones <- c(\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\ndata[,..info_canciones,]\n\ninfo_canciones2 <- c(\"snapshot_date\",\"duration_ms\", \"danceability\", \"energy\", \"loudness\", \"speechiness\", \"acousticness\",\"instrumentalness\",\"liveness\")\n\ndata[format(snapshot_date, \"%Y-%m\") == \"2024-09\" , ..info_canciones2]\n```\n\n:::\n\n## Deseleccionar columas\n\nSimilar a las formas de seleccionar columnas podemos utilizar los operadores `-` y `!` para evitar la selección de ciertas columnas o rangos de columnas.\n\n```{r}\ndata[,-c(\"name\",\"artists\")] %>% colnames()\n\ndata[,!c(\"spotify_id\")] %>% colnames()\n\ndata[,!(key:time_signature)] %>% colnames()\n```\n\n## Renombrar columnas\n\nEn el espacio de operaciones sobre las columnas también se pueden renombrar las columnas. \n\n```{r}\ndata[, .(artista = artists, song_name = name)]\n```\n\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"tema3.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","knitr":{"opts_chunk":{"R.options":{"width":120}}},"theme":"flatly","code-wrap":true,"page-layout":"full","code-block-style":"line-wrap","grid":{"body-width":"1100px","sidebar-width":"250px","margin-width":"150px","gutter-width":"0.8em"},"title":"Filtros y selección de columnas"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}